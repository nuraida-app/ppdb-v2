import{j as e,a as c,aa as P,T as v,B as x,F as r,r as F,ci as D,R as j,C as d,I as k,s as u,a2 as S,bA as T,S as L}from"./index-CMEssXRz.js";import{U as y}from"./UserLayout-nMT1gBCx.js";import{D as o,h as R}from"./html2pdf-CYvgK_0J.js";import{D as B}from"./index-ulRLnMvx.js";import{I as N}from"./index-B2SgWHdp.js";import{T as w}from"./index-CvT0uTZg.js";import{S as t}from"./index-BKxVm03t.js";import{U as C,R as O}from"./index-C9TcQmG5.js";import"./DeleteOutlined-CiED4gRi.js";import"./DownloadOutlined-C2117LVZ.js";const{Title:U}=v,A=({data:a})=>{const i=()=>{const s=document.querySelector(".print-content"),l={margin:.5,filename:`Invoice-Pembayaran-${a.nama}.pdf`,image:{type:"png",quality:.98},html2canvas:{scale:2,useCORS:!0},jsPDF:{unit:"in",format:"a4",orientation:"portrait"}};R().set(l).from(s).save()};return e.jsxs(c,{children:[e.jsxs(P,{justify:"space-between",align:"center",children:[e.jsx(U,{level:4,style:{textAlign:"center",marginBottom:24},children:"Invoice Pembayaran"}),e.jsx(x,{type:"primary",onClick:i,children:"Download PDF"})]}),e.jsxs("div",{className:"print-content",children:[e.jsxs(o,{bordered:!0,column:1,children:[e.jsx(o.Item,{label:"Nama",children:a.nama}),e.jsx(o.Item,{label:"Email",children:a.email}),e.jsx(o.Item,{label:"Nomor Telepon",children:a.tlp}),e.jsxs(o.Item,{label:"Nominal",children:["Rp ",parseInt(a.nominal).toLocaleString("id-ID")]}),e.jsx(o.Item,{label:"Tanggal Pembayaran",children:new Date(a.tgl_bayar).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsx(B,{children:"Bukti Pembayaran"}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(N,{src:a.berkas,alt:"Bukti Pembayaran",style:{maxWidth:"100%",maxHeight:"400px"}})})]})]})},M=({user:a})=>{const[i]=r.useForm(),[s,l]=F.useState([]),[g,{isLoading:b}]=D(),f=async n=>{var h;if(!s.length){u.error("Bukti pembayaran harus diupload!");return}const m=new FormData;m.append("nama",n.nama),m.append("nominal",n.nominal),m.append("media",n.media),m.append("file",s[0].originFileObj);try{await g(m).unwrap(),u.success("Data pembayaran berhasil disimpan!"),i.resetFields(),l([])}catch(p){u.error(((h=p==null?void 0:p.data)==null?void 0:h.message)||"Gagal menyimpan pembayaran")}},I=n=>Array.isArray(n)?n:n==null?void 0:n.fileList;return e.jsx(c,{title:"Form Pembayaran",children:e.jsxs(r,{form:i,layout:"vertical",onFinish:f,initialValues:{nama:a==null?void 0:a.nama},children:[e.jsxs(j,{gutter:16,children:[e.jsx(d,{xs:24,md:12,children:e.jsx(r.Item,{name:"nama",label:"Nama Calon Siswa",rules:[{required:!0,message:"Nama harus diisi!"}],children:e.jsx(k,{disabled:!0})})}),e.jsx(d,{xs:24,md:12,children:e.jsx(r.Item,{name:"nominal",label:"Nominal Pembayaran",rules:[{required:!0,message:"Nominal harus diisi!"}],children:e.jsx(w,{style:{width:"100%"},formatter:n=>`Rp ${n}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:n=>n.replace(/\Rp\s?|(,*)/g,"")})})})]}),e.jsxs(j,{gutter:16,children:[e.jsx(d,{xs:24,md:12,children:e.jsx(r.Item,{name:"media",label:"Media Informasi",rules:[{required:!0,message:"Media informasi harus diisi!"}],children:e.jsxs(t,{placeholder:"Pilih Media Informasi",children:[e.jsx(t.Option,{value:"Website",children:"Website"}),e.jsx(t.Option,{value:"Instagram",children:"Instagram"}),e.jsx(t.Option,{value:"Facebook",children:"Facebook"}),e.jsx(t.Option,{value:"YouTube",children:"YouTube"}),e.jsx(t.Option,{value:"Radio",children:"Radio"}),e.jsx(t.Option,{value:"Kerabat",children:"Kerabat"})]})})}),e.jsx(d,{xs:24,md:12,children:e.jsx(r.Item,{name:"upload",label:"Upload Bukti Pembayaran",valuePropName:"fileList",getValueFromEvent:I,rules:[{required:!0,message:"Bukti pembayaran harus diupload!"}],children:e.jsx(C,{listType:"picture",maxCount:1,beforeUpload:()=>!1,onChange:({fileList:n})=>l(n),children:e.jsx(x,{icon:e.jsx(O,{}),children:"Upload Bukti Pembayaran"})})})})]}),e.jsx(r.Item,{children:e.jsx(x,{type:"primary",htmlType:"submit",loading:b,children:"Simpan Pembayaran"})})]})})},Q=()=>{const{user:a}=S(l=>l.auth),{data:i,isLoading:s}=T(a==null?void 0:a.id,{skip:!(a!=null&&a.id)});return console.log(i),s?e.jsx(y,{title:"Pembayaran",children:e.jsx(c,{children:e.jsxs("div",{style:{textAlign:"center",padding:"50px"},children:[e.jsx(L,{size:"large"}),e.jsx("p",{style:{marginTop:"20px"},children:"Loading payment data..."})]})})}):e.jsxs(y,{title:"Pembayaran",children:[!i&&e.jsx(M,{user:a}),i&&!(i!=null&&i.ket)&&e.jsx(c,{children:e.jsx("div",{style:{textAlign:"center",padding:"40px 0"},children:e.jsx("p",{style:{fontSize:18,color:"#faad14"},children:"Menunggu konfirmasi pembayaran..."})})}),(i==null?void 0:i.ket)&&e.jsx(A,{data:i})]})};export{Q as default};
